<%= f.error_messages %>

<% proposals = @weal.proposals 
	if !proposals.empty? %>
	<%= f.hidden_field "#{@other_holding_as}_id" %>
	<div id="intention_proposals_box">
	<p class='box_title'>Proposals</p>
	<%= radio_button_tag 'accepter', 1,@weal.attributes["#{@other_holding_as}_id"].nil?, {:onClick => "$('weal_#{@other_holding_as}_id').value=null"}%> Acceptance pending <br />
	<% for p in proposals %>
		<p class="intention_proposal_source">
		From <%=h p.user.full_name %>
		</p>
		<p class="intention_proposal_description">
				<%=h p.description %>
		</p>
		<%= radio_button_tag 'accepter',1,@weal.attributes["#{@other_holding_as}_id"] == p.user_id, {:onClick => "$('weal_#{@other_holding_as}_id').value=#{p.user_id}"}%> Accept this proposal
	  
	<% end %>
	</div>
<% end %>

<p>
  <%= f.label :title %><br />
  <%= f.text_field :title,:size=>80 %>
</p>
<p>
  <%= f.label :description %><br />
  <%= f.text_area :description, :cols=>70,:rows => 10 %>
</p>
<p>
	Is a requirement of: 
	<%= f.select(:parent_id, current_user.weals.reject {|w| w.id == @weal.id}.collect {|w| [ w.title, w.id ] }, :include_blank => '-none-')%>
<p>
<% case @type
	when :intentions %>
<%if @weal.matched? %>
	<p>
		I am holding this intention as:  <%=  @holding_as %>
	</p>
	<p>
		The <%= @other_holding_as %> is:  <%= @other_party.full_name %>
	</p>
<% else %>
	<p>
		I am holding this intention as:
		<% if proposals.empty? %>
			<%= radio_button_tag('as', 'requester', checked = @weal.requester == current_user || @weal.new_record?) %> requester
			<%= radio_button_tag('as', 'fulfiller', checked = @weal.fulfiller == current_user) %> fulfiller
		<%else%>
			<%=  @holding_as %>
		<% end %>
	</p>
<%end%>
<% when :weals 
	users = User.find(:all)%>
<p>
  <%= f.label :requester_id %><br />
  <%= f.select(:requester_id, users.collect {|p| [ p.full_name, p.id ] }, {:include_blank => '-'})%>
</p>
<p>
  <%= f.label :fulfiller_id %><br />
  <%= f.select(:fulfiller_id, users.collect {|p| [ p.full_name, p.id ] }, {:include_blank => '-'})%>
</p>
<% end %>
<p>
	Wealth generated by this intention will be measured in: <br />
	<% for currency in @currencies 
		exists = @weal.currencies.exists?(currency.id)
		%>
		<%= check_box_tag("currencies[#{currency.id}]",'1',exists)%> <%=render_currency_icon(currency)%> 
		<%= currency.name %>
		<%= currency.api_input_html("currencies[#{currency.id}_val]",exists ? @weal.currency_weal_links.find(:first,:conditions => "currency_id = #{currency.id}").link_spec : nil) %>
		<%=  hidden_field_tag "currencies[#{currency.id}]", '0'%>
		<br />
	<% end %>
</p>
<p>
	Tags: 
	<%= text_field_tag("tags",@weal.tag_list.join(', '),:size=>100) %>
<p>
