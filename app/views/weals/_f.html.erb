<%= f.error_messages %>

<p>
  <%= f.label :title %><br />
  <%= f.text_field :title,:size=>80 %>
</p>
<p>
  <%= f.label :description %> (this will be WYSIWG soon)<br />
  <%= f.text_area :description, :cols=>70,:rows => 2 %>
</p>
<p>
  <%= f.label :notes %> (this will be WYSIWG soon)<br />
  <%= f.text_area :notes, :cols=>70,:rows => 5 %>
</p>
<p>
  Is a requirement of: 
  <%= f.select(:parent_id, current_user.weals.reject {|w| w.id == @weal.id}.collect {|w| [ w.title, w.id ] }, :include_blank => '-none-')%>
<p>
<% case @phase
  when :intention %>
  <p>
    <% if @weal && !@weal.in_service_of.blank?
      @states_selected = @weal.in_service_of.split(/,/).collect {|x| i = x.to_i; i != 0 ? i : x}
    end %>

    <label for="weal_in_service_of">This intention is in service of: </label><br/>
    <%= select_tag 'weal[in_service_of][]', options_for_select(options_for_select_in_service_of, @states_selected), { :multiple => true, :size =>5, :id => "weal_in_service_of" } %>
  </p>

<%if @weal.matched? %>
  <p>
    I am holding this intention as:  <%=  @holding_as %>
  </p>
  <p>
    The <%= @other_holding_as %> is:  <%= @other_party.full_name %>
  </p>
<% else %>
  <p>
    I am holding this intention as:
    <% if @proposals.nil? || @proposals.empty? %>
      <%= radio_button_tag('as', 'requester', checked = @weal.requester == current_user || @weal.new_record?) %> requester
      <%= radio_button_tag('as', 'offerer', checked = @weal.offerer == current_user) %> offerer
    <%else%>
      <%=  @holding_as %>
    <% end %>
  </p>
<%end%>
<% when :action %>
<p>Requester: <%= @weal.requester.full_name%></p>
<p>Offerer: <%= @weal.offerer.full_name%></p>

<% when :weals 
  users = User.find(:all)%>
<p>
  <%= f.label :requester_id %><br />
  <%= f.select(:requester_id, users.collect {|p| [ p.full_name, p.id ] }, {:include_blank => '-'})%>
</p>
<p>
  <%= f.label :offerer_id %><br />
  <%= f.select(:offerer_id, users.collect {|p| [ p.full_name, p.id ] }, {:include_blank => '-'})%>
</p>
<% end %>
<p>
  Wealth generated by this intention will be expressed in: <br />
  <table>
    <tr><th>Currency</th><th>Type</th><th>Scope</th><th># accts</th><th>Description</th><th>Amount</th></tr>
  <% for currency in @currencies 
    exists = @weal.currencies.exists?(currency.id)
    %>
      <tr>
        <td>
        <%= check_box_tag("currencies[#{currency.id}][used]",'1',exists) %>
        <%= render_currency_icon(currency) %>
        <%= h currency.name %>
        </td>
        <td><%= currency.humanized_type %></td>
        <td><%= currency.humanized_scope %></td>
        <td><%= currency.currency_accounts_total %></td>
        <td><%= h currency.description %></td>
        <td>..amount..
          <%= %Q|currency.api_input_html("currencies[#{currency.id}][val]",exists ? @weal.currency_weal_links.find(:first,:conditions => "currency_id = #{currency.id}").link_spec : nil)|;'' %>
          <%=  hidden_field_tag "currencies[#{currency.id}][used]", '0'%>
        </td>
      <tr>
  <% end %>
  </table>
</p>
<p>
  Tags: 
  <%= text_field_tag("tags",@weal.tag_list.join(', '),:size=>100) %>
<p>
